<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Diego & Cami — 14/02/2026</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --verde-osc:#234122;
  --verde-claro:#6b8b6b;
  --beige:#e7dfc7;
  --accent:#bfb58e;
  --bg:#f6f4ec;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: 'Montserrat', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background:var(--bg);
  color:var(--verde-osc);
  line-height:1.35;
}

.wrap{max-width:1200px;margin:24px auto;padding:0 18px;}

/* PORTADA MINIMALISTA */
#cover{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:16px;
  text-align:center;
  padding:24px;
}
#cover h1{
  font-family:'Great Vibes', cursive;
  font-size:3rem;
  color:var(--verde-osc);
}
#cover .sub{
  font-family:'Great Vibes', cursive;
  font-size:1.25rem;
  color:var(--verde-claro);
}
#cover img{
  max-width:420px;
  width:100%;
  border-radius:8px;
  box-shadow:0 6px 20px rgba(0,0,0,0.1);
}

/* BARRA DE PROGRESO */
#upload-progress-container {
  width:100%;
  max-width:420px;
  height:20px;
  background:#e0e0e0;
  border-radius:10px;
  overflow:hidden;
  margin:10px auto;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
.progress-bar {
  height:100%;
  width:0%;
  background: linear-gradient(90deg, #6b8b6b, #bfb58e);
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:12px;
  font-weight:600;
  transition: width 0.3s ease;
}

/* BOTONES */
.cover-actions{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}
.btn{
  padding:10px 18px;
  border-radius:30px;
  border:none;
  font-weight:700;
  background:var(--beige);
  color:var(--verde-osc);
  cursor:pointer;
  box-shadow:0 4px 12px rgba(34,65,41,0.1);
}
.btn.ghost{
  background:transparent;
  border:2px solid var(--beige);
  color:var(--verde-osc);
}
.btn:hover{
  transform:translateY(-2px);
  transition:transform .18s ease;
}

/* GALERÍA */
#gallery-container{display:none;padding:28px 0}
#controls{display:flex;align-items:center;gap:12px;margin-bottom:18px;flex-wrap:wrap;}
#controls .layout-btn, #controls .back-btn{padding:8px 14px;border-radius:8px;border:none;background:var(--beige);color:var(--verde-osc);font-weight:700;cursor:pointer;}
#controls .back-btn{background:transparent;border:2px solid var(--beige)}
#controls .layout-btn.active{box-shadow:0 6px 18px rgba(34,65,41,0.06);}
.gallery{width:100%}
.gallery.masonry{column-count:3;column-gap:14px}
@media(max-width:1000px){ .gallery.masonry{column-count:2} }
@media(max-width:600px){ .gallery.masonry{column-count:1} }
.gallery.masonry .item{display:inline-block;width:100%;margin:0 0 14px;border-radius:10px;overflow:hidden}
.item{position:relative;cursor:pointer;overflow:hidden;border-radius:8px}
.item img{width:100%;height:auto;display:block;transition:transform .35s ease,filter .35s ease}
.item:hover img{transform:scale(1.03)}
#lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,10,6,0.8);z-index:9999;padding:20px}
#lightbox img{max-width:calc(100% - 80px);max-height:calc(100% - 100px);border-radius:8px}
#lightbox .close{position:absolute;top:18px;right:18px;background:var(--beige);color:var(--verde-osc);border:none;padding:8px 12px;border-radius:8px;font-weight:800}

@media(max-width:480px){
  #cover h1{font-size:2.4rem;}
  #cover img{max-width:300px;}
}
</style>
</head>
<body>

<div class="wrap">

  <!-- PORTADA -->
  <section id="cover" aria-label="Portada">
    <h1>Diego &amp; Cami</h1>
    <div class="sub">Nuestra mejor historia comienza hoy</div>
    <img id="cover-photo" src="PortadaGaleria.jpg" alt="Diego y Cami">

    <!-- BARRA DE PROGRESO -->
    <div id="upload-progress-container"></div>

    <div class="cover-actions">
      <button id="view-gallery" class="btn">Ver Galería</button>
      <button id="upload-photos" class="btn ghost">Subir Fotos</button>
    </div>

    <!-- INPUT OCULTO PARA SUBIDA -->
    <input type="file" id="photo-input" multiple style="display:none">
  </section>

  <!-- GALERÍA -->
  <section id="gallery-container" aria-label="Galería de fotos">
    <div id="controls">
      <button class="back-btn" id="back-to-cover">← Atrás</button>
      <div style="flex:1"></div>
      <button class="layout-btn" data-layout="masonry">Pinterest Vibes</button>
      <button class="layout-btn" data-layout="minimal">Minimal Elegante</button>
      <button class="layout-btn" data-layout="dark">Dark Moderno</button>
      <button class="layout-btn" data-layout="fullscreen">Fullscreen Classy</button>
    </div>
    <div id="gallery" class="gallery masonry" aria-live="polite"></div>
  </section>

</div>

<!-- LIGHTBOX -->
<div id="lightbox" role="dialog" aria-hidden="true">
  <button class="close" id="lb-close">Cerrar ✕</button>
  <img id="lb-img" src="" alt="Foto grande">
</div>

<script>
const gallery = document.getElementById('gallery');
const galleryContainer = document.getElementById('gallery-container');
const cover = document.getElementById('cover');
const viewBtn = document.getElementById('view-gallery');
const backBtn = document.getElementById('back-to-cover');
const layoutBtns = document.querySelectorAll('.layout-btn');
const lightbox = document.getElementById('lightbox');
const lbImg = document.getElementById('lb-img');
const lbClose = document.getElementById('lb-close');
const uploadBtn = document.getElementById('upload-photos');
const photoInput = document.getElementById('photo-input');
const progressContainer = document.getElementById('upload-progress-container');

/* === LIGHTBOX === */
let images = [];
let currentIdx = 0;
function openLightbox(i){
  currentIdx = i;
  lbImg.src = images[i].url;
  lightbox.style.display = 'flex';
  lightbox.setAttribute('aria-hidden','false');
}
function closeLightbox(){
  lightbox.style.display='none';
  lightbox.setAttribute('aria-hidden','true');
  lbImg.src='';
}
lbClose.addEventListener('click', closeLightbox);
lightbox.addEventListener('click', (e)=>{if(e.target===lightbox) closeLightbox();});
document.addEventListener('keydown', (e)=>{
  if(lightbox.style.display!=='flex') return;
  if(e.key==='Escape') closeLightbox();
  if(e.key==='ArrowRight'){currentIdx=(currentIdx+1)%images.length; lbImg.src=images[currentIdx].url;}
  if(e.key==='ArrowLeft'){currentIdx=(currentIdx-1+images.length)%images.length; lbImg.src=images[currentIdx].url;}
});

/* === MOSTRAR PORTADA / GALERÍA === */
viewBtn.addEventListener('click', ()=>{
  cover.style.display='none';
  galleryContainer.style.display='block';
  loadGallery();
  window.scrollTo({top:0,behavior:'smooth'});
});
backBtn.addEventListener('click', ()=>{
  galleryContainer.style.display='none';
  cover.style.display='flex';
  window.scrollTo({top:0,behavior:'smooth'});
});

/* === LAYOUT BOTONES === */
layoutBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    layoutBtns.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    gallery.className='gallery '+btn.dataset.layout;
  });
});
document.querySelector('.layout-btn[data-layout="masonry"]').classList.add('active');

/* === CARGAR GALERÍA DESDE BACKEND === */
async function loadGallery(){
  try{
    const res = await fetch('https://boda2026.onrender.com/gallery');
    images = await res.json();
    gallery.innerHTML='';
    images.forEach((img,i)=>{
      const div = document.createElement('div');
      div.className='item';
      div.innerHTML=`<img src="${img.url}" alt="${img.uploader||'Foto'}" data-index="${i}" loading="lazy">`;
      div.addEventListener('click', ()=>openLightbox(i));
      gallery.appendChild(div);
    });
  }catch(err){console.error(err);}
}

/* === SUBIDA DE FOTOS CON PROGRESO === */
uploadBtn.addEventListener('click', ()=>photoInput.click());

photoInput.addEventListener('change', async (e)=>{
  const files = e.target.files;
  if(!files.length) return;

  for(let file of files){
    const progressBar = document.createElement('div');
    progressBar.className='progress-bar';
    progressBar.textContent=`Subiendo ${file.name}`;
    progressBar.style.width='0%';
    progressContainer.appendChild(progressBar);

    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset','unsigned_preset');
    formData.append('folder','boda2026');

    try{
      const res = await fetch('https://api.cloudinary.com/v1_1/de3zy3vvo/image/upload',{
        method:'POST',
        body: formData
      });
      if(!res.ok) throw new Error('Error en la subida');
      const data = await res.json();

      progressBar.style.width='100%';
      progressBar.textContent='Subida completa';

      // Registrar en tu backend
      await fetch('https://boda2026.onrender.com/add-photo',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({url:data.secure_url,uploader:"Invitado"})
      });

    }catch(err){
      console.error(err);
      progressBar.textContent='Error';
    }finally{
      setTimeout(()=>progressBar.remove(),1500);
    }
  }

  await loadGallery();
  e.target.value='';
});
</script>

</body>
</html>
