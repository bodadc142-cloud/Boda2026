<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Diego & Cami — Álbum Boda</title>

<!-- Tipografía serif romántica + sans para UI -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">

<style>
:root{
  --verde-osc:#234122;
  --verde-claro:#6b8b6b;
  --beige:#e7dfc7;
  --accent:#bfb58e;
  --bg:#f6f4ec;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:'Montserrat', sans-serif;background:var(--bg);color:var(--verde-osc);line-height:1.35}

.wrap{max-width:1200px;margin:24px auto;padding:0 18px}

/* Botón subir */
#uploadBtn{
  padding:12px 20px;border-radius:30px;border:none;font-weight:700;
  background:var(--beige); color:var(--verde-osc); cursor:pointer;
  box-shadow:0 6px 18px rgba(34,65,41,0.06);
  margin-bottom:20px;
}

/* Galería Rustic Chic */
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
.item{position:relative;overflow:hidden;border-radius:8px;background:#fff;box-shadow:0 4px 12px rgba(34,65,41,0.08)}
.item img, .item video{width:100%;height:auto;display:block;object-fit:cover;cursor:pointer}
.item video{max-height:250px}

/* Lightbox fullscreen */
#lightbox{
  position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(6,10,6,0.85);z-index:9999;padding:20px;flex-direction:column;
}
#lightbox img,#lightbox video{max-width:calc(100% - 80px);max-height:calc(100% - 120px);border-radius:8px}
#lb-close{position:absolute;top:18px;right:18px;background:var(--beige);color:var(--verde-osc);
border:none;padding:8px 12px;border-radius:8px;font-weight:800;cursor:pointer}
#lb-credit{margin-top:12px;color:#eee;font-size:0.95rem;font-style:italic}

</style>
</head>
<body>

<div class="wrap">
  <h2 style="font-family:'Playfair Display', serif;margin-bottom:16px;text-align:center">Álbum de la Boda</h2>
  <button id="uploadBtn">Subir fotos</button>
  <input id="fileInput" type="file" accept="image/*,video/*" multiple hidden>
  
  <div id="gallery" class="gallery"></div>
</div>

<!-- Lightbox -->
<div id="lightbox" role="dialog" aria-hidden="true">
  <button id="lb-close">Cerrar ✕</button>
  <div id="lb-content"></div>
  <div id="lb-credit"></div>
</div>

<script>
// === Configuración Cloudinary ===
const cloudName = "de3zy3vvo";
const uploadPreset = "unsigned_preset";
const maxWidth = 2048; // R2

// === Subida de archivos ===
const uploadBtn = document.getElementById("uploadBtn");
const fileInput = document.getElementById("fileInput");

uploadBtn.addEventListener("click", () => fileInput.click());

fileInput.addEventListener("change", async (event) => {
  const files = event.target.files;
  if(!files.length) return;

  const uploaderName = prompt("¿Quién sos?") || "Anónimo";

  for(let file of files){
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", uploadPreset);
    formData.append("context", `uploader=${uploaderName}`);
    formData.append("transformation", `c_limit,w_${maxWidth}`);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
      method:"POST",
      body: formData
    });

    const data = await res.json();
    console.log("Subida:", data.secure_url);

    // Agregar a galería inmediatamente
    addToGallery(data);
  }
  fileInput.value = "";
});

// === Galería ===
const gallery = document.getElementById("gallery");

async function loadGallery(){
  const res = await fetch(`https://res.cloudinary.com/${cloudName}/image/list/all.json`);
  const data = await res.json();
  // Orden: nuevas primero
  const sorted = data.resources.sort((a,b)=> new Date(b.created_at) - new Date(a.created_at));
  sorted.forEach(r => addToGallery(r));
}

function addToGallery(resource){
  const div = document.createElement("div");
  div.className = "item";
  
  if(resource.resource_type==="video" || resource.format==="mp4"){
    div.innerHTML = `<video src="${resource.secure_url}" controls></video>`;
  } else {
    div.innerHTML = `<img src="${resource.secure_url}" alt="Foto de la boda">`;
  }

  div.addEventListener("click", ()=>openLightbox(resource));
  gallery.appendChild(div);
}

// === Lightbox ===
const lightbox = document.getElementById("lightbox");
const lbClose = document.getElementById("lb-close");
const lbContent = document.getElementById("lb-content");
const lbCredit = document.getElementById("lb-credit");

function openLightbox(resource){
  lbContent.innerHTML = "";
  if(resource.resource_type==="video" || resource.format==="mp4"){
    const v = document.createElement("video");
    v.src = resource.secure_url;
    v.controls = true;
    v.autoplay = true;
    lbContent.appendChild(v);
  } else {
    const img = document.createElement("img");
    img.src = resource.secure_url;
    lbContent.appendChild(img);
  }
  lbCredit.textContent = resource.context?.custom?.uploader ? `Subido por: ${resource.context.custom.uploader}` : "";
  lightbox.style.display = "flex";
}

lbClose.addEventListener("click", ()=>lightbox.style.display="none");
lightbox.addEventListener("click", e => {if(e.target===lightbox) lightbox.style.display="none";});

// === Inicializar galería al cargar ===
loadGallery();

</script>

</body>
</html>
