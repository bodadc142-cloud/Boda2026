<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Diego & Cami — 14/02/2026</title>
<style>
:root{
  --verde-osc:#234122;
  --bg:#f6f4ec;
  --beige:#e7dfc7;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:sans-serif;background:var(--bg);color:var(--verde-osc)}
.wrap{max-width:1200px;margin:24px auto;padding:0 18px;}
#cover{display:flex;flex-direction:column;align-items:center;gap:18px;text-align:center;}
#cover img{max-width:400px;width:100%;border-radius:6px;}
h1{font-family:'serif';font-size:3rem;margin:12px 0;}
#cover-actions{display:flex;gap:12px;margin-top:12px;}
.btn{padding:10px 18px;border-radius:30px;border:none;font-weight:700;background:var(--beige);cursor:pointer;color:var(--verde-osc);}
#gallery-container{display:none;padding:28px 0;}
.gallery{column-count:3;column-gap:14px;}
@media(max-width:1000px){ .gallery{column-count:2} }
@media(max-width:600px){ .gallery{column-count:1} }
.item{display:inline-block;width:100%;margin:0 0 14px;border-radius:10px;overflow:hidden;cursor:pointer;}
.item img{width:100%;height:auto;display:block;transition:transform .35s ease;}
.item:hover img{transform:scale(1.03);}
#lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,10,6,0.8);z-index:9999;padding:20px;}
#lightbox img{max-width:calc(100% - 80px);max-height:calc(100% - 100px);border-radius:8px;}
#lightbox .close{position:absolute;top:18px;right:18px;background:var(--beige);color:var(--verde-osc);border:none;padding:8px 12px;border-radius:8px;font-weight:800;}
#progress{margin-top:12px;font-weight:700;color:var(--verde-osc);}
</style>
</head>
<body>
<div class="wrap">

  <!-- PORTADA -->
  <section id="cover">
    <img src="PortadaGaleria.jpg" alt="Diego y Cami">
    <h1>Diego & Cami</h1>
    <div id="cover-actions">
      <button id="view-gallery" class="btn">Ver Galería</button>
      <button id="upload-photos" class="btn">Subir Fotos</button>
    </div>
    <div id="progress"></div>
  </section>

  <!-- GALERÍA -->
  <section id="gallery-container">
    <div id="gallery" class="gallery"></div>
  </section>

</div>

<!-- LIGHTBOX -->
<div id="lightbox">
  <button class="close" id="lb-close">Cerrar ✕</button>
  <img id="lb-img" src="" alt="Foto grande">
</div>

<script>
const gallery = document.getElementById('gallery');
const galleryContainer = document.getElementById('gallery-container');
const cover = document.getElementById('cover');
const viewBtn = document.getElementById('view-gallery');
const uploadBtn = document.getElementById('upload-photos');
const progress = document.getElementById('progress');

const lightbox = document.getElementById('lightbox');
const lbImg = document.getElementById('lb-img');
const lbClose = document.getElementById('lb-close');

let images = [];
let currentIdx = 0;

function openLightbox(i){
  currentIdx = i;
  lbImg.src = images[i].url;
  lightbox.style.display = 'flex';
}
function closeLightbox(){
  lightbox.style.display='none';
  lbImg.src='';
}
lbClose.addEventListener('click', closeLightbox);
lightbox.addEventListener('click',(e)=>{if(e.target===lightbox) closeLightbox();});
document.addEventListener('keydown',(e)=>{
  if(lightbox.style.display!=='flex') return;
  if(e.key==='Escape') closeLightbox();
  if(e.key==='ArrowRight'){currentIdx=(currentIdx+1)%images.length; lbImg.src=images[currentIdx].url;}
  if(e.key==='ArrowLeft'){currentIdx=(currentIdx-1+images.length)%images.length; lbImg.src=images[currentIdx].url;}
});

/* Mostrar portada/galería */
viewBtn.addEventListener('click', ()=>{
  cover.style.display='none';
  galleryContainer.style.display='block';
  loadGallery();
  window.scrollTo({top:0,behavior:'smooth'});
});

/* Cargar galería */
async function loadGallery(){
  try{
    const res = await fetch('https://boda2026.onrender.com/gallery');
    images = await res.json();
    gallery.innerHTML='';
    images.forEach((img,i)=>{
      const div = document.createElement('div');
      div.className='item';
      div.innerHTML=`<img src="${img.url}" alt="${img.uploader||'Foto'}" data-index="${i}">`;
      div.addEventListener('click',()=>openLightbox(i));
      gallery.appendChild(div);
    });
  }catch(err){console.error(err);}
}

/* Subir fotos */
uploadBtn.addEventListener('click', async ()=>{
  const uploader = prompt("Ingresa tu nombre:");
  if(!uploader) return;

  const files = await new Promise(resolve=>{
    const input = document.createElement('input');
    input.type='file';
    input.multiple=true;
    input.accept='image/*';
    input.onchange = ()=>resolve(Array.from(input.files));
    input.click();
  });

  for(let i=0;i<files.length;i++){
    progress.textContent = `Cargando foto ${i+1}/${files.length}...`;
    const formData = new FormData();
    formData.append('file', files[i]);
    formData.append('upload_preset','unsigned_preset');
    formData.append('folder','boda2026');
    formData.append('context', JSON.stringify({uploader:uploader}));

    try{
      const res = await fetch(`https://api.cloudinary.com/v1_1/de3zy3vvo/upload`,{
        method:'POST',
        body: formData
      });
      const data = await res.json();
    }catch(err){
      console.error(err);
    }
  }

  progress.style.color='green';
  progress.textContent='Carga completada';
  loadGallery();
});
</script>
</body>
</html>
