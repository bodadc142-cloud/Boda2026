<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Álbum Boda 2026</title>
<style>
body{font-family:sans-serif;background:#f6f4ec;color:#234122;line-height:1.35;padding:24px;text-align:center}
#uploadBtn{padding:12px 20px;border-radius:30px;border:none;background:#e7dfc7;color:#234122;cursor:pointer;margin-bottom:20px;font-size:1.1rem}
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;justify-items:center}
.item{position:relative;overflow:hidden;border-radius:8px;background:#fff;box-shadow:0 4px 12px rgba(34,65,41,0.08)}
.item img, .item video{width:100%;height:auto;display:block;object-fit:cover;cursor:pointer}
#lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,10,6,0.85);z-index:9999;padding:20px;flex-direction:column}
#lb-close{position:absolute;top:18px;right:18px;background:#e7dfc7;color:#234122;border:none;padding:8px 12px;border-radius:8px;font-weight:800;cursor:pointer}
#lb-credit{margin-top:12px;color:#eee;font-size:0.95rem;font-style:italic}
#lb-content img, #lb-content video{max-width:90vw;max-height:80vh}
</style>
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
</head>
<body>

<h1>Álbum de la Boda</h1>
<p>Subí tus fotos y mirá la galería</p>
<button id="uploadBtn">Subir fotos</button>
<div id="gallery" class="gallery"></div>

<div id="lightbox">
  <button id="lb-close">Cerrar ✕</button>
  <div id="lb-content"></div>
  <div id="lb-credit"></div>
</div>

<script>
const gallery = document.getElementById("gallery");
const uploadBtn = document.getElementById("uploadBtn");
const lightbox = document.getElementById("lightbox");
const lbClose = document.getElementById("lb-close");
const lbContent = document.getElementById("lb-content");
const lbCredit = document.getElementById("lb-credit");

const cloudName = "TU_CLOUD_NAME";
const uploadPreset = "TU_UNSIGNED_PRESET";

// Función para pedir nombre del invitado
function getUploaderName(){
  let name = prompt("Por favor, escribí tu nombre:", "Anónimo");
  if(!name) name="Anónimo";
  return name;
}

// Cargar galería desde servidor
async function loadGallery(){
  try {
    const res = await fetch("https://TU_SERVIDOR/gateway/gallery");
    const images = await res.json();
    images.reverse().forEach(addToGallery); // nuevas primero
  } catch(err){ console.error("No se pudo cargar la galería:", err); }
}

// Crear widget de Cloudinary
const myWidget = cloudinary.createUploadWidget({
  cloudName,
  uploadPreset,
  sources: ['local'],
  multiple: true,
  folder: "boda_2026",
  maxFileSize: 5000000,
  clientAllowedFormats: ["jpg","jpeg","png","mp4"],
  resourceType: "auto",
  theme: "minimal",
  showCompletedButton: true
}, (error, result) => {
  if(!error && result && result.event==="success") addToGallery(result.info);
});

uploadBtn.addEventListener("click", ()=>{
  const uploaderName = getUploaderName();
  myWidget.update({ context: { uploader: uploaderName } });
  myWidget.open();
});

// Agregar foto a la galería
function addToGallery(info){
  const div = document.createElement("div");
  div.className="item";
  const uploader = info.context && info.context.uploader ? info.context.uploader : "Anónimo";
  if(info.resource_type==="video"){
    div.innerHTML=`<video src="${info.secure_url}" controls></video>`;
  } else {
    div.innerHTML=`<img src="${info.secure_url}" alt="Foto de la boda">`;
  }
  div.addEventListener("click", ()=>openLightbox(info.secure_url, uploader, info.resource_type));
  gallery.prepend(div);
}

// Lightbox
function openLightbox(url, uploader, type){
  lbContent.innerHTML="";
  if(type==="video"){
    const v=document.createElement("video"); v.src=url; v.controls=true; v.autoplay=true; lbContent.appendChild(v);
  } else {
    const img=document.createElement("img"); img.src=url; lbContent.appendChild(img);
  }
  lbCredit.textContent=`Subido por: ${uploader}`;
  lightbox.style.display="flex";
}
lbClose.addEventListener("click", ()=>lightbox.style.display="none");
lightbox.addEventListener("click", e=>{if(e.target===lightbox) lightbox.style.display="none";});

loadGallery();
</script>

</body>
</html>
